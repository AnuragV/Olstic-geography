<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scrabble: Country Edition</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #121212;
      color: #f0f0f0;
      text-align: center;
      padding: 1rem;
    }
    #game { display: flex; flex-direction: column; align-items: center; }

    #board {
      display: grid;
      grid-template: repeat(15, 44px) / repeat(15, 44px);
      border: 2px solid #444;
      margin-bottom: 1rem;
    }

    .cell {
      width: 44px;
      height: 44px;
      border: 1px solid #666;
      border-radius: 5px;
      font-weight: bold;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      color: white;
      background: #2c2c2c;
    }

    .mult-DL { background: #3498db; }
    .mult-TL { background: #21618c; }
    .mult-DW { background: #e74c3c; }
    .mult-TW { background: #922b21; }

    .cell.mult-DL::after,
    .cell.mult-TL::after,
    .cell.mult-DW::after,
    .cell.mult-TW::after {
      content: attr(data-label);
      position: absolute;
      font-size: 0.7em;
      color: white;
    }

    #rack {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 1rem;
    }

    .tile {
      width: 44px;
      height: 44px;
      background: orange;
      color: black;
      font-weight: bold;
      border-radius: 5px;
      margin: 4px;
      cursor: grab;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: transform 0.2s ease;
      font-size: 1rem;
    }

    .tile span.points {
      font-size: 0.7em;
    }

    .tile.dragging {
      transform: scale(1.2);
      z-index: 1000;
    }

    #controls {
      display: flex;
      gap: 10px;
      margin-bottom: 1rem;
    }

    button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
    }

    #scoreboard {
      font-size: 1.1rem;
      margin-top: 0.5rem;
    }

    .highlighted {
      outline: 2px solid gold;
    }

    audio { display: none; }
  </style>
</head>
<body>
  <div id="game">
    <h1>üåç Country Scrabble Game (Dark Mode)</h1>
    <div id="board"></div>

    <div id="controls">
      <button id="submitBtn">‚úÖ Submit Word</button>
      <button id="undoBtn">üîÑ Undo Word</button>
    </div>

    <div id="rack"></div>

    <div id="scoreboard">
      Score: <span id="score">0</span> |
      Time Left: <span id="timer">10:00</span>
    </div>
  </div>

  <!-- Embedded click sound (base64-encoded) -->
  <audio id="clickSound">
    <source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAA... (truncated)" type="audio/mp3" />
    Your browser does not support the audio element.
  </audio>
<script>
const board = document.getElementById("board");
const rack = document.getElementById("rack");
const scoreDisplay = document.getElementById("score");
const timerDisplay = document.getElementById("timer");
const clickSound = document.getElementById("clickSound");

const tilePoints = {
  A:1,B:3,C:3,D:2,E:1,F:4,G:2,H:4,I:1,J:8,K:5,L:1,M:3,
  N:1,O:1,P:3,Q:10,R:1,S:1,T:1,U:1,V:4,W:4,X:8,Y:4,Z:10
};

const multiplierMap = {};
["0,0","0,7","0,14","7,0","7,14","14,0","14,7","14,14"].forEach(p => multiplierMap[p]="TW");
["1,1","2,2","3,3","4,4","7,7","10,10","11,11","12,12","13,13"].forEach(p => multiplierMap[p]="DW");
["1,5","5,1","5,5","5,9","9,5","9,9","13,9","9,13"].forEach(p => multiplierMap[p]="TL");
["0,3","2,6","3,0","3,7","6,2","6,6","6,8","7,3","8,6","11,0","11,7","14,3"].forEach(p => multiplierMap[p]="DL");

let placedTiles = [];
let totalScore = 0;
let usedCoords = new Set();

function buildBoard() {
  for (let r = 0; r < 15; r++) {
    for (let c = 0; c < 15; c++) {
      const cell = document.createElement("div");
      const key = `${r},${c}`;
      const mult = multiplierMap[key] || "NORMAL";
      cell.className = `cell mult-${mult}`;
      cell.dataset.row = r;
      cell.dataset.col = c;
      cell.dataset.label = mult === "NORMAL" ? "" : mult;
      cell.ondragover = e => e.preventDefault();
      cell.ondrop = handleDrop;
      board.appendChild(cell);
    }
  }
}

function buildRack() {
  for (let i = 65; i <= 90; i++) {
    const ch = String.fromCharCode(i);
    const tile = createTile(ch);
    rack.appendChild(tile);
  }
}

function createTile(letter) {
  const tile = document.createElement("div");
  tile.className = "tile";
  tile.innerHTML = `${letter}<br><span class="points">(${tilePoints[letter]})</span>`;
  tile.dataset.letter = letter;
  tile.draggable = true;

  tile.addEventListener("dragstart", e => {
    tile.classList.add("dragging");
    e.dataTransfer.setData("text/plain", letter);
    e.dataTransfer.setData("source", "rack");
  });

  tile.addEventListener("dragend", () => tile.classList.remove("dragging"));
  return tile;
}

function handleDrop(e) {
  const letter = e.dataTransfer.getData("text/plain");
  const source = e.dataTransfer.getData("source");

  if (!letter) return;
  const existing = e.target.querySelector(".tile");

  // drag from board to rack
  if (e.currentTarget.id === "rack") {
    if (source !== "board") return;
    const draggedTile = document.querySelector(".tile.dragging");
    if (draggedTile) {
      draggedTile.remove();
      const newTile = createTile(letter);
      rack.appendChild(newTile);
      placedTiles = placedTiles.filter(cell => cell.contains(draggedTile));
      playClick();
    }
    return;
  }

  // drag from rack to board
  if (source !== "rack") return;
  if (existing) return;

  const tile = createTile(letter);
  tile.setAttribute("draggable", true);
  tile.setAttribute("data-letter", letter);
  tile.classList.add("dragging");

  tile.addEventListener("dragstart", e => {
    tile.classList.add("dragging");
    e.dataTransfer.setData("text/plain", letter);
    e.dataTransfer.setData("source", "board");
  });
  tile.addEventListener("dragend", () => tile.classList.remove("dragging"));

  e.target.appendChild(tile);
  placedTiles.push(e.target);
  playClick();
}

function playClick() {
  clickSound.currentTime = 0;
  clickSound.play();
}

function getNewWordTiles() {
  return placedTiles.filter(cell => !usedCoords.has(`${cell.dataset.row},${cell.dataset.col}`));
}

function extractWordFromTiles(cells) {
  if (cells.length === 0) return "";
  const sameRow = cells.every(c => c.dataset.row === cells[0].dataset.row);
  const sameCol = cells.every(c => c.dataset.col === cells[0].dataset.col);

  if (!sameRow && !sameCol) return "";

  const word = cells
    .sort((a, b) => {
      return sameRow
        ? +a.dataset.col - +b.dataset.col
        : +a.dataset.row - +b.dataset.row;
    })
    .map(cell => cell.firstChild?.dataset.letter || "")
    .join("");

  return word;
}

function scoreWord(word, tiles) {
  let wordMult = 1, score = 0;
  tiles.forEach(cell => {
    const letter = cell.firstChild?.dataset.letter;
    const mult = multiplierMap[`${cell.dataset.row},${cell.dataset.col}`];
    let pts = tilePoints[letter] || 0;
    if (mult === "DL") pts *= 2;
    else if (mult === "TL") pts *= 3;
    if (mult === "DW") wordMult *= 2;
    else if (mult === "TW") wordMult *= 3;
    score += pts;
  });
  return score * wordMult;
}

const validCountries = [
  "AFGHANISTAN","ALBANIA","ALGERIA","ANDORRA","ANGOLA","ANTIGUA","ARGENTINA","ARMENIA",
  "AUSTRALIA","AUSTRIA","AZERBAIJAN","BAHAMAS","BAHRAIN","BANGLADESH","BARBADOS","BELARUS",
  "BELGIUM","BELIZE","BENIN","BHUTAN","BOLIVIA","BOSNIA","BOTSWANA","BRAZIL","BRUNEI",
  "BULGARIA","BURKINA","BURUNDI","CABOVERDE","CAMBODIA","CAMEROON","CANADA","CENTRALAFRICANREPUBLIC",
  "CHAD","CHILE","CHINA","COLOMBIA","COMOROS","CONGO","COSTARICA","CROATIA","CUBA","CYPRUS","CZECHIA",
  "DENMARK","DJIBOUTI","DOMINICA","DOMINICANREPUBLIC","ECUADOR","EGYPT","ELSALVADOR","EQUATORIALGUINEA",
  "ERITREA","ESTONIA","ESWATINI","ETHIOPIA","FIJI","FINLAND","FRANCE","GABON","GAMBIA","GEORGIA",
  "GERMANY","GHANA","GREECE","GRENADA","GUATEMALA","GUINEA","GUINEABISSAU","GUYANA","HAITI","HONDURAS",
  "HUNGARY","ICELAND","INDIA","INDONESIA","IRAN","IRAQ","IRELAND","ISRAEL","ITALY","IVORYCOAST",
  "JAMAICA","JAPAN","JORDAN","KAZAKHSTAN","KENYA","KIRIBATI","KOREA","KOSOVO","KUWAIT","KYRGYZSTAN",
  "LAOS","LATVIA","LEBANON","LESOTHO","LIBERIA","LIBYA","LIECHTENSTEIN","LITHUANIA","LUXEMBOURG",
  "MADAGASCAR","MALAWI","MALAYSIA","MALDIVES","MALI","MALTA","MARSHALLISLANDS","MAURITANIA",
  "MAURITIUS","MEXICO","MICRONESIA","MOLDOVA","MONACO","MONGOLIA","MONTENEGRO","MOROCCO","MOZAMBIQUE",
  "MYANMAR","NAMIBIA","NAURU","NEPAL","NETHERLANDS","NEWZEALAND","NICARAGUA","NIGER","NIGERIA",
  "NORTHKOREA","NORTHMACEDONIA","NORWAY","OMAN","PAKISTAN","PALAU","PALESTINE","PANAMA",
  "PAPUANEWGUINEA","PARAGUAY","PERU","PHILIPPINES","POLAND","PORTUGAL","QATAR","ROMANIA","RUSSIA",
  "RWANDA","SAINTKITTS","SAINTLUCIA","SAINTVINCENT","SAMOA","SANMARINO","SAOTOMEANDPRINCIPE",
  "SAUDIARABIA","SENEGAL","SERBIA","SEYCHELLES","SIERRALEONE","SINGAPORE","SLOVAKIA","SLOVENIA",
  "SOLOMONISLANDS","SOMALIA","SOUTHAFRICA","SOUTHKOREA","SOUTHSUDAN","SPAIN","SRI LANKA",
  "SUDAN","SURINAME","SWEDEN","SWITZERLAND","SYRIA","TAIWAN","TAJIKISTAN","TANZANIA","THAILAND",
  "TIMORLESTE","TOGO","TONGA","TRINIDADANDTOBAGO","TUNISIA","TURKEY","TURKMENISTAN","TUVALU",
  "UGANDA","UKRAINE","UNITEDARABEMIRATES","UNITEDKINGDOM","UNITEDSTATES","URUGUAY","UZBEKISTAN",
  "VANUATU","VATICANCITY","VENEZUELA","VIETNAM","YEMEN","ZAMBIA","ZIMBABWE"
];

document.getElementById("submitBtn").onclick = () => {
  const newTiles = getNewWordTiles();
  const word = extractWordFromTiles(newTiles).toUpperCase();

  if (!validCountries.includes(word)) {
    alert("‚ùå Invalid country: " + word);
    return;
  }

  // Must connect with existing tiles
  if (usedCoords.size > 0 && !newTiles.some(cell => {
    const key = `${cell.dataset.row},${cell.dataset.col}`;
    return Array.from(usedCoords).some(coord => coord === key);
  })) {
    alert("‚ùå Word must connect with existing tiles.");
    return;
  }

  totalScore += scoreWord(word, newTiles);
  scoreDisplay.textContent = totalScore;

  newTiles.forEach(cell => {
    usedCoords.add(`${cell.dataset.row},${cell.dataset.col}`);
    cell.classList.add("highlighted");
  });

  placedTiles = [];
};

document.getElementById("undoBtn").onclick = () => {
  placedTiles.forEach(cell => {
    if (cell.firstChild && !usedCoords.has(`${cell.dataset.row},${cell.dataset.col}`)) {
      cell.firstChild.remove();
    }
  });
  placedTiles = [];
};

function startTimer(duration) {
  let time = duration;
  const timer = setInterval(() => {
    const mins = String(Math.floor(time / 60)).padStart(2, "0");
    const secs = String(time % 60).padStart(2, "0");
    timerDisplay.textContent = `${mins}:${secs}`;
    if (--time < 0) {
      clearInterval(timer);
      alert(`‚è±Ô∏è Time's up! You scored ${totalScore} points.`);
    }
  }, 1000);
}

buildBoard();
buildRack();
startTimer(600);
</script>
</body>
</html>
