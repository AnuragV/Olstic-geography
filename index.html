<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Break the Code: Arrange the Balloons</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #000;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
      overflow: hidden;
    }

    h1 {
      color: #ffd700;
      margin: 20px;
    }

    .game-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      width: 100%;
    }

    .table {
      display: flex;
      justify-content: center;
      align-items: end;
      height: 250px;
      gap: 20px;
    }

    .bowl {
      width: 60px;
      height: 30px;
      background-color: #654321;
      border-radius: 50%/100%;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: end;
    }

    .balloon {
      width: 50px;
      height: 65px;
      border-radius: 50% 50% 45% 45%;
      position: absolute;
      top: -65px;
      cursor: grab;
    }

    .balloon::after {
      content: "";
      width: 2px;
      height: 30px;
      background: black;
      position: absolute;
      left: 50%;
      top: 100%;
      transform: translateX(-50%);
    }

    .controls {
      display: flex;
      gap: 10px;
      margin: 10px;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .submit {
      background-color: #ffd700;
      color: black;
    }

    .new-code {
      background-color: white;
      color: black;
    }

    .info {
      background-color: #444;
      color: white;
      width: 30px;
      height: 30px;
      text-align: center;
      border-radius: 50%;
      font-weight: bold;
    }

    .status {
      display: flex;
      gap: 10px;
      margin: 10px;
    }

    .status-box {
      background-color: #ffd700;
      color: black;
      padding: 10px 20px;
      border-radius: 5px;
    }

    .leaderboard {
      margin-top: 10px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Break the Code: Arrange the Balloons</h1>
  <div class="game-area">
    <div class="table" id="table"></div>

    <div class="status">
      <div class="status-box" id="attemptsBox">Attempts: 0</div>
      <div class="status-box" id="correctBox">0 balloons are placed correctly</div>
    </div>

    <div class="controls">
      <button class="submit" onclick="submitGuess()">Submit Guess</button>
      <button class="new-code" onclick="initializeGame()">New Code</button>
      <button class="info" onclick="toggleInstructions()">?</button>
    </div>

    <div class="leaderboard">
      <h3>Leaderboard</h3>
      <ol id="leaderboardList"></ol>
    </div>
  </div>

  <div id="instructionModal" style="display:none;position:absolute;top:50px;left:50%;transform:translateX(-50%);background:#333;color:white;padding:20px;border-radius:10px;max-width:300px;z-index:100">
    <h3>Instructions</h3>
    <p>Drag the balloons to arrange them in the correct order. Click "Submit Guess" to see how many are correct. Use "New Code" to restart. Try to crack the code in minimum attempts!</p>
    <button onclick="toggleInstructions()">Close</button>
  </div>

  <audio id="popSound" src="https://www.soundjay.com/button/button-16.mp3"></audio>

  <script>
    const allColors = ["red", "white", "blue", "green", "yellow"];
    let correctOrder = [];
    let currentOrder = [];
    let attempts = 0;
    let username = "";

    window.onload = () => {
      username = prompt("Enter your username:");
      initializeGame();
    };

    function initializeGame() {
      const table = document.getElementById("table");
      table.innerHTML = "";
      attempts = 0;
      document.getElementById("attemptsBox").innerText = `Attempts: ${attempts}`;

      correctOrder = shuffle([...allColors]);
      let initOrder = shuffle([...allColors]);
      while (countCorrect(initOrder, correctOrder) > 0) {
        initOrder = shuffle([...allColors]);
      }
      currentOrder = [...initOrder];

      initOrder.forEach((color, index) => {
        const bowl = document.createElement("div");
        bowl.className = "bowl";
        bowl.dataset.index = index;

        const balloon = document.createElement("div");
        balloon.className = "balloon";
        balloon.style.backgroundColor = color;
        balloon.draggable = true;
        balloon.dataset.color = color;

        balloon.addEventListener("dragstart", dragStart);
        bowl.addEventListener("dragover", dragOver);
        bowl.addEventListener("drop", drop);

        bowl.appendChild(balloon);
        table.appendChild(bowl);
      });
    }

    function dragStart(e) {
      e.dataTransfer.setData("text/plain", e.target.dataset.color);
      e.dataTransfer.setData("fromIndex", [...e.target.parentNode.parentNode.children].indexOf(e.target.parentNode));
    }

    function dragOver(e) {
      e.preventDefault();
    }

    function drop(e) {
      const color = e.dataTransfer.getData("text/plain");
      const fromIndex = e.dataTransfer.getData("fromIndex");
      const toIndex = e.currentTarget.dataset.index;

      if (fromIndex === toIndex) return;

      const table = document.getElementById("table");
      const fromBowl = table.children[fromIndex];
      const toBowl = table.children[toIndex];
      const fromBalloon = fromBowl.querySelector(".balloon");
      const toBalloon = toBowl.querySelector(".balloon");

      fromBowl.appendChild(toBalloon);
      toBowl.appendChild(fromBalloon);

      let temp = currentOrder[fromIndex];
      currentOrder[fromIndex] = currentOrder[toIndex];
      currentOrder[toIndex] = temp;
    }

    function submitGuess() {
      attempts++;
      document.getElementById("attemptsBox").innerText = `Attempts: ${attempts}`;

      const correct = countCorrect(currentOrder, correctOrder);
      document.getElementById("correctBox").innerText = `${correct} balloons are placed correctly`;
      document.getElementById("popSound").play();

      updateLeaderboard();
    }

    function countCorrect(arr1, arr2) {
      return arr1.reduce((count, val, idx) => count + (val === arr2[idx] ? 1 : 0), 0);
    }

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function toggleInstructions() {
      const modal = document.getElementById("instructionModal");
      modal.style.display = modal.style.display === "none" ? "block" : "none";
    }

    function updateLeaderboard() {
      const key = "leaderboard";
      let board = JSON.parse(localStorage.getItem(key)) || [];

      board.push({ username, attempts });
      board.sort((a, b) => a.attempts - b.attempts);
      board = board.slice(0, 5);

      localStorage.setItem(key, JSON.stringify(board));

      const list = document.getElementById("leaderboardList");
      list.innerHTML = "";
      board.forEach(entry => {
        const li = document.createElement("li");
        li.textContent = `${entry.username}: ${entry.attempts} attempts`;
        list.appendChild(li);
      });
    }
  </script>
</body>
</html>
